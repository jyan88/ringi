<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_cb_design_topic">
    <sys_cb_design_topic action="INSERT_OR_UPDATE">
        <compiled_topic display_value="_PRVW__ff6abe6b4d2633009c69aeb8fe8e8c27">fb6abe6b4f2633000c1c4a10a310c728</compiled_topic>
        <design_definition>{"type":"FlowTopic","triggers":[{"type":"Trigger","name":"5bec25ec0011488fb3435e9a65c5d969","triggerType":"request","id":"5bec25ec0011488fb3435e9a65c5d969"}],"goals":[{"name":"Knowledge Search","trigger_id":"5bec25ec0011488fb3435e9a65c5d969","nodes":[{"type":"StartGoal","goal_id":"da95f18c30244b82a5954e5180fa7f92","greeting_msg":{"type":"String","mode":"script","value":"(function execute() {\n    /* Script the string logic here.\n       Be sure to return a quoted string.\n\n       For example:\n\n       var result;\n       var x = 1;\n       if (x == 1) {\n           result = 'hi there';\n       } else {\n           result = 'how are you?';\n       }\n       return result;\n    */\n    return '';\n})()\n"},"id":"9926a2b0b9a6465fb505cedf60526b04","name":"Start"},{"type":"TerminateGoal","goal_id":"da95f18c30244b82a5954e5180fa7f92","confirmation_msg":{"type":"String","mode":"string","value":"Thanks for using our support chat! Have a great day!"},"id":"45a9b6cd063d42daa35c88110a89331e","name":"End"},{"type":"InputPrompt","variable_id":"1e39a806b6e54e07aaa5bfc7259ada37","message":{"type":"String","mode":"string","value":"Enter a phrase to search the knowledge base."},"optional":false,"id":"b6ecd568ed3246419fcdfce839e9871a","name":"Search Term","goal_id":"da95f18c30244b82a5954e5180fa7f92"},{"type":"ScriptedAction","script":"(function execute() {\n    /* Uses the searh term inputed by user and calls the Contextual Search using the search context created\n       to return a max of 20 results and stores them JSON string.\n    */\n    var search_term = vaInputs.search_term;\n    var context = vaVars.search_context_sys_id;\n    var contextualSearch = new sn_itsm_va.VAContextualSearchUtil();\n    var response = contextualSearch.search(context, search_term);\n    var success = contextualSearch.processSearchResponse(response);\n    if (!success) {\n        return;\n    }   \n    var relevantSearchResults = contextualSearch.processGeneralResults(response, 20,0);\n    vaVars.kbResultCount = relevantSearchResults.length;\n    vaVars.search_kb_json_string = JSON.stringify(relevantSearchResults);\n    vaVars.index = 0;\n    return;\n})()\n","id":"0bad36e69b0a45c98a7c2b9735b6ab86","name":"Contextual Search","goal_id":"da95f18c30244b82a5954e5180fa7f92"},{"type":"ReferenceChoiceInputPrompt","mode":"external","id":"e337aed21fba4701bd145537c644883b","name":"KB Selection","goal_id":"da95f18c30244b82a5954e5180fa7f92","variable_id":"140ed64e415349aea883a0cb4ad0be8e","message":{"type":"String","mode":"script","value":"(function execute() {\n    if (vaVars.kbResultCount &gt; 0)\n        return gs.getMessage('Alright, how else can I help? Here\\'s what I can do:');\n\n    return gs.getMessage(\"Sorry, I couldn't find anything on that topic. What would you like to do?\");\n})()\n"},"optional":false,"expression_mode":"script","script":"(function execute() {\n    /*\n    Pagination buttons for suggested KB articles.\n    */\n    var options = [];\n    var limit = parseInt(vaVars.limit);\n    var index = parseInt(vaVars.index);\n    \n    if (index &gt;= limit) {\n        options.push({ 'value': 'show_prev', 'label': gs.getMessage('Show previous')});    \n    }\n\n    if (index+limit &lt; vaVars.kbResultCount) {\n        options.push({ 'value': 'show_next', 'label': gs.getMessage('Show more')});    \n    }\n    options.push({ 'value': 'new_search', 'label': gs.getMessage('Try a different search')});\n    options.push({ 'value': 'cancel', 'label': gs.getMessage('I\\'m done')});\n    return options;\n})()\n","no_options_found_message":{"type":"String","mode":"string","value":"No Records Found"},"condition":{"type":"Condition","mode":"external_script","value":"(function execute() {\n    /*\n    Pagination buttons for suggested KB articles.\n    */\n    var options = [];\n    var limit = parseInt(vaVars.limit);\n    var index = parseInt(vaVars.index);\n    \n    if (index &gt;= limit) {\n        options.push({ 'value': 'show_prev', 'label': gs.getMessage('Show previous')});    \n    }\n\n    if (index+limit &lt; vaVars.kbResultCount) {\n        options.push({ 'value': 'show_next', 'label': gs.getMessage('Show more')});    \n    }\n    options.push({ 'value': 'new_search', 'label': gs.getMessage('Try a different search')});\n    options.push({ 'value': 'cancel', 'label': gs.getMessage('I\\'m done')});\n    return options;\n})()\n"}},{"type":"Decision","name":"Knowledge Choice Decision","branches":[{"type":"Branch","label":"Cancel","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.kb_selection == 'cancel';\n})()\n"},"id":"150859ce68a24c6580c4e0f9942fe1ca","name":"Cancel"},{"type":"Branch","label":"New Search","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.kb_selection == 'new_search';\n})()\n"},"id":"e45afc90fe8e49ff9e282d2c9e1a63cf","name":"New Search"},{"type":"Branch","label":"Show Next","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.kb_selection == 'show_next';\n})()\n"},"id":"8c3fb0325c2744f99ff3635372f9227d","name":"Show Next"},{"type":"Branch","label":"Show Previous","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.kb_selection == 'show_prev';\n})()\n"},"id":"3a419020725648e6be3884721e4f1a07","name":"Show Previous"}],"id":"6246b492aacf47dfb2308a0b9b353e73","goal_id":"da95f18c30244b82a5954e5180fa7f92"},{"type":"ScriptedAction","script":"(function execute() {\n    vaVars.index = parseInt(vaVars.index) + parseInt(vaVars.limit);\n    return '';\n})()\n","id":"792bd942d60a4359aeb0de2741fc2ac0","name":"Next","goal_id":"da95f18c30244b82a5954e5180fa7f92"},{"type":"ScriptedAction","script":"(function execute() {\n    vaVars.index = parseInt(vaVars.index) - parseInt(vaVars.limit);\n    return '';\n})()\n","id":"23b8fccff4704e9a84506c670e93b284","name":"Previous","goal_id":"da95f18c30244b82a5954e5180fa7f92"},{"type":"ScriptOutputPrompt","output_type":"single_part","id":"b7a6b500f76f430a9f51e2d084a3c69f","name":"Display KB(s)","goal_id":"da95f18c30244b82a5954e5180fa7f92","value":{"type":"String","mode":"string","value":"(function execute() {\n      var limit = parseInt(vaVars.limit);\n\n      var kbJsonObj = JSON.parse(vaVars.search_kb_json_string);\n\n      var baseURL = gs.getProperty('glide.servlet.uri') + '/';\n      vaVars.baseURL = baseURL;\n      vaVars.kblinks = \"\";\n      var index = parseInt(vaVars.index);\n      for (var i = 0; i &lt; limit &amp;&amp; i + index &lt; kbJsonObj.length; i++) {\n\n            var link = baseURL + gs.getProperty('sn_itsm_va.com.snc.itsm.virtualagent.portal_url') + '?id=kb_article&amp;sys_id=' + kbJsonObj[i].id.split(':')[1];\n            vaVars.kblinks += \"&lt;a href=\"+link+' target=\"_blank\"&gt;&lt;b&gt;'+kbJsonObj[i].title+\"&lt;/b&gt;&lt;/a&gt;\"+\n                  \"&lt;br/&gt;\"+kbJsonObj[i].snippet.substring(0,240)+\"&lt;/b&gt;...\";\n\n            if (i &lt; limit - 1 &amp;&amp; i + index &lt; kbJsonObj.length - 1)\n                  vaVars.kblinks += \"&lt;br/&gt;&lt;br/&gt;\";\n      }\n\n      return vaVars.kblinks;\n})()\n"}},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"No KBs","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return !(vaVars.kbResultCount &gt; 0);\n})()\n"},"id":"9837fece808f40c7bca6f21d9ed0ecc2","name":"No KBs"},{"type":"Branch","label":"Found KB(s)","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaVars.kbResultCount &gt; 0;\n})()\n"},"id":"d3621162935548afbf0cc91892e3d49e","name":"Found KB(s)"}],"id":"bc9a3e3a026347ff99ca19ea78e539fc","goal_id":"da95f18c30244b82a5954e5180fa7f92"},{"type":"OutputPrompt","value":{"type":"String","mode":"string","value":"Here are the results I found in our Knowledge Base that might help you."},"id":"78b7bc585fe9499180bf22ff560fab8a","name":"Found Result Message","goal_id":"da95f18c30244b82a5954e5180fa7f92"}],"edges":[{"type":"Edge","source_node_id":"78b7bc585fe9499180bf22ff560fab8a","target_node_id":"b7a6b500f76f430a9f51e2d084a3c69f","id":"2f58a5c9c81541c789305d8b34910f77"},{"type":"Edge","source_node_id":"b7a6b500f76f430a9f51e2d084a3c69f","target_node_id":"e337aed21fba4701bd145537c644883b","id":"d6a0983b42fe4de19c92a8ae68e05f7a"},{"type":"Edge","source_node_id":"9926a2b0b9a6465fb505cedf60526b04","target_node_id":"b6ecd568ed3246419fcdfce839e9871a","id":"2e1e1c5b66d14faa95044be9e7647261"},{"type":"Edge","source_node_id":"b6ecd568ed3246419fcdfce839e9871a","target_node_id":"0bad36e69b0a45c98a7c2b9735b6ab86","id":"7938599790694218a9c117cdcf198ee4"},{"type":"Edge","source_node_id":"e337aed21fba4701bd145537c644883b","target_node_id":"6246b492aacf47dfb2308a0b9b353e73","id":"04915d9386be4ccc80a098ac52482cf6"},{"type":"Edge","source_node_id":"6246b492aacf47dfb2308a0b9b353e73","target_node_id":"45a9b6cd063d42daa35c88110a89331e","branch_id":"150859ce68a24c6580c4e0f9942fe1ca","id":"ee33c4b117c64a1a9b7fe42bc73fe229","name":"150859ce68a24c6580c4e0f9942fe1ca"},{"type":"Edge","source_node_id":"6246b492aacf47dfb2308a0b9b353e73","target_node_id":"b6ecd568ed3246419fcdfce839e9871a","branch_id":"e45afc90fe8e49ff9e282d2c9e1a63cf","id":"e998e757112f4f84a94f4d7e1fcfe4f9","name":"e45afc90fe8e49ff9e282d2c9e1a63cf"},{"type":"Edge","source_node_id":"6246b492aacf47dfb2308a0b9b353e73","target_node_id":"792bd942d60a4359aeb0de2741fc2ac0","branch_id":"8c3fb0325c2744f99ff3635372f9227d","id":"738f7739cb29450eb9f3900135ec8624","name":"8c3fb0325c2744f99ff3635372f9227d"},{"type":"Edge","source_node_id":"792bd942d60a4359aeb0de2741fc2ac0","target_node_id":"b7a6b500f76f430a9f51e2d084a3c69f","id":"72c7dd094b4f4e75a0768d8aaba64c77"},{"type":"Edge","source_node_id":"6246b492aacf47dfb2308a0b9b353e73","target_node_id":"23b8fccff4704e9a84506c670e93b284","branch_id":"3a419020725648e6be3884721e4f1a07","id":"38e4cccdf6504d13a908adb65c8f33ce","name":"3a419020725648e6be3884721e4f1a07"},{"type":"Edge","source_node_id":"23b8fccff4704e9a84506c670e93b284","target_node_id":"b7a6b500f76f430a9f51e2d084a3c69f","id":"123ba890c1034dce883d5224a9cb44ca"},{"type":"Edge","source_node_id":"0bad36e69b0a45c98a7c2b9735b6ab86","target_node_id":"bc9a3e3a026347ff99ca19ea78e539fc","id":"008790f79b7f41cbaa33b5ae7577dba2"},{"type":"Edge","source_node_id":"bc9a3e3a026347ff99ca19ea78e539fc","target_node_id":"e337aed21fba4701bd145537c644883b","branch_id":"9837fece808f40c7bca6f21d9ed0ecc2","id":"cd5a7dfe543549899b136033770c5849","name":"9837fece808f40c7bca6f21d9ed0ecc2"},{"type":"Edge","source_node_id":"bc9a3e3a026347ff99ca19ea78e539fc","target_node_id":"78b7bc585fe9499180bf22ff560fab8a","branch_id":"d3621162935548afbf0cc91892e3d49e","id":"58d8cdeea65b44ee95a6c8afed8089ea","name":"d3621162935548afbf0cc91892e3d49e"}],"id":"da95f18c30244b82a5954e5180fa7f92"}],"script_variables":[{"type":"String","name":"search_kb_json_string","id":"8ae5d5148e044f8fa932ed77758779f5"},{"type":"String","name":"index","value":{"type":"String","mode":"script"},"id":"ad47fdfd78bc4be08cfdb49fc5772fb0"},{"type":"String","name":"limit","value":{"type":"String","mode":"string","value":"3"},"id":"1b70284dc2e248dcb5b92e7eec62fd65"},{"type":"String","name":"search_context_sys_id","value":{"type":"String","mode":"string","value":"2821675a5b30130070e4492c11f91a89"},"id":"a7c1e49697934420af5c434446793d30"},{"type":"String","name":"kbResultCount","value":{"type":"String","mode":"string","value":"0"},"id":"37c057d857064a598de944809aed018d"},{"type":"String","name":"LiveAgent_application","value":{"type":"String","mode":"string","value":"itsm"},"id":"dc8dbf06e73d4abf8c628b72137d3e01"}],"glide_variables":[{"type":"String","name":"search_term","id":"1e39a806b6e54e07aaa5bfc7259ada37"},{"type":"Choice","choices":[],"id":"140ed64e415349aea883a0cb4ad0be8e","name":"kb_selection","table":""}],"roles":[],"scope":"134450a0b3781300787162ac16a8dc1e","id":"70dd76bddb781300cde2fd131d9619a8","name":"_PRVW__ff6abe6b4d2633009c69aeb8fe8e8c27","key_phrases":["knowledge"," question"," kb"," article"," search"," how"]}</design_definition>
        <design_topic_id>70dd76bddb781300cde2fd131d9619a8</design_topic_id>
        <name>_PRVW__ff6abe6b4d2633009c69aeb8fe8e8c27</name>
        <sys_class_name>sys_cb_design_topic</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2019-07-16 07:57:33</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_id>776abe6b4f2633000c1c4a10a310c72f</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>FlowTopic</sys_name>
        <sys_package display_value="ワークフローテスト" source="x_348695_workflowt">7c64ffd34f2133000c1c4a10a310c7ab</sys_package>
        <sys_policy/>
        <sys_scope display_value="ワークフローテスト">7c64ffd34f2133000c1c4a10a310c7ab</sys_scope>
        <sys_update_name>sys_cb_design_topic_776abe6b4f2633000c1c4a10a310c72f</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2019-07-16 07:57:33</sys_updated_on>
        <type>FlowTopic</type>
    </sys_cb_design_topic>
</record_update>
